% Define the package name and version
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{bttda-paper}[2024/10/23 v1.0 Basic paper setup for BT-TDA]

% Packages
\RequirePackage[
	backend=biber,
	style=numeric,
	sorting=none,
	doi=false,
	url=false,
	%issn=false
]{biblatex}
\RequirePackage[T1]{fontenc}
\RequirePackage{hyperref}
\RequirePackage{booktabs}
\RequirePackage{subcaption}
\RequirePackage{tikz}
\RequirePackage{expl3}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{tabularx}
\RequirePackage{float}
\RequirePackage{makecell}
\RequirePackage{algorithm}
\RequirePackage{algpseudocode}
\RequirePackage{siunitx}
\RequirePackage{acro}
\RequirePackage{cleveref}
\RequirePackage{microtype}
\RequirePackage{changepage}

% Layout
\renewcommand*{\bibfont}{\footnotesize}
\captionsetup{subrefformat=parens}%

\makeatletter
\let\@leftfloatplacement=\@floatplacement
\def\@rightfloatplacement{\global\@topnum=0
	% Textpage bit, global:
	\global\@toproom=\z@
	\global\@botnum=0
	\global\@botroom=\z@
	\global\@colnum=0
	% Floatpage bit, local:
	\@fpmin=\@colht}
\def\@floatplacement{\if@firstcolumn\@leftfloatplacement
	\else\@rightfloatplacement
	\fi}
\makeatother

% Setup PGF plots
\RequirePackage{pgfplots}
\usepgfplotslibrary{groupplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.18}
\pgfplotsset{%
	group/xticklabels at=edge bottom,
	group/yticklabels at=edge left,
	group/xlabels at=edge bottom,
	group/ylabels at=edge left,
}
\pgfplotscreateplotcyclelist{colorTriangle}{
	blue,every mark/.append style={fill=blue!80!black},mark=*\\
	red,every mark/.append style={fill=red!80!black},mark=square*\\
	brown!60!black,every mark/.append style={fill=brown!80!black},mark=triangle*\\
	black,mark=star\\
	blue,every mark/.append style={fill=blue!80!black},mark=diamond*\\
	red,densely dashed,every mark/.append style={solid,fill=red!80!black},mark=*\\
	brown!60!black,densely dashed,every mark/.append style={
			solid,fill=brown!80!black},mark=square*\\
	black,densely dashed,every mark/.append style={solid,fill=gray},mark=otimes*\\
	blue,densely dashed,mark=star,every mark/.append style=solid\\
	red,densely dashed,every mark/.append style={solid,fill=red!80!black},mark=diamond*\\
}

% Math declarations
\newcommand{\ten}[1]{\underline{\mathbf{#1}}} % tensor
\newcommand{\mat}[1]{\mathbf{#1}} % matrix
\renewcommand{\vec}[1]{\mathbf{#1}} % matrix
\newcommand{\mpr}[2]{\times_{#2} {#1}_{#2}} % mode product
\newcommand{\mmpr}[1]{\times\left\{#1\right\}} % multi-mode product
\newcommand{\mmpri}[1]{\times\{#1\}} % inline multi-mode product
\newcommand{\mmprs}[2]{\times_{-#2}\left\{#1\right\}} % multi-mode product skip
\newcommand{\mmprsi}[2]{\times_{-#2}\{#1\}} % inline multi-mode product skip
\newcommand{\ev}[2]{\text{E}\left[#1\right]_{#2}}

\newcommand{\argmax}{\mathop{\mathrm{argmax}}}
\newcommand{\argmin}{\mathop{\mathrm{argmin}}}
\newcommand{\vect}{\mathop{\mathrm{vec}}}
\newcommand{\nmse}{\mathop{\mathrm{NMSE}}}
\newcommand{\tr}{\mathop{\mathrm{Tr}}}

% Acronym declarations
\input{acro.tex}

% Tensor visualization

\newcommand{\Width}{2}
\newcommand{\Height}{2}
\newcommand{\Depth}{-2}
\newcommand{\TensorThree}[7]{
	\renewcommand{\Width}{#5}
	\renewcommand{\Height}{#6}
	\renewcommand{\Depth}{-#7}
	\coordinate (O) at (0,0,0);
	\coordinate (A) at (0,\Height,0);
	\coordinate (B) at (0,\Height,\Depth);
	\coordinate (C) at (0,0,\Depth);
	\coordinate (D) at (\Width,0,0);
	\coordinate (E) at (\Width,\Height,0);
	\coordinate (F) at (\Width,\Height,\Depth);
	\coordinate (G) at (\Width,0,\Depth);


	\node at (\fpeval{0.5*#5},\fpeval{0.5*#6},0) {#1};

	\draw (O) -- (A)node[midway,left] {#3};
	\draw (O) -- (C)node[midway,xshift=-.5em, yshift=.5em] {#2};
	\draw (O) -- (D);
	\draw[densely dotted] (F) -- (B);
	\draw (F) -- (E);
	\draw (F) -- (G);
	\draw[densely dotted] (A) -- (B);
	\draw (C) -- (G);
	\draw[densely dotted] (B) -- (C);
	\draw (G) -- (D);
	\draw (A) -- (E)node[midway,below] {#4};
	\draw (E) -- (D) ;
}

\newcommand{\TensorTwo}[5]{
	\renewcommand{\Width}{#4}
	\renewcommand{\Height}{#5}
	\coordinate (B) at (0,\Height,0);
	\coordinate (C) at (0,0,0);
	\coordinate (F) at (\Width,\Height,0);
	\coordinate (G) at (\Width,0,0);
	\node at (\fpeval{0.5*#4},\fpeval{0.5*#5},0) {#1};
	\draw (B) -- (C) node[midway, left] {#2};
	\draw (F) -- (B) node[midway, below] {#3};
	\draw (F) -- (G);
	\draw (C) -- (G);
}

\newcommand{\MatrixLeft}[5]{
	\renewcommand{\Width}{-#4}
	\renewcommand{\Height}{#5}
	\coordinate (B) at (0,\Height,0);
	\coordinate (C) at (0,0,0);
	\coordinate (F) at (\Width,\Height,0);
	\coordinate (G) at (\Width,0,0);
	\node at (\fpeval{-0.5*#4},\fpeval{0.5*#5},0) {#1};
	\draw (B) -- (C);
	\draw (F) -- (B) node[midway, below] {#3};
	\draw (F) -- (G)node[midway,left] {#2};
	\draw (C) -- (G);
}
\newcommand{\MatrixBelow}[5]{
	\renewcommand{\Width}{#4}
	\renewcommand{\Height}{#5}
	\coordinate (B) at (0,\Height,0);
	\coordinate (C) at (0,0,0);
	\coordinate (F) at (\Width,\Height,0);
	\coordinate (G) at (\Width,0,0);
	\node at (\fpeval{0.5*#4},\fpeval{0.5*#5},0) {#1};
	\draw (B) -- (C);
	\draw (F) -- (B) node[midway, below] {#2};
	\draw (F) -- (G)node[midway,right] {#3};
	\draw (C) -- (G);
}
\newcommand{\MatrixSkewed}[5]{
	\renewcommand{\Depth}{-#5}
	\coordinate (B) at (0,0, \Depth);
	\coordinate (C) at (0,0,0);
	\coordinate (F) at (\fpeval{-#4/1.414},\fpeval{-#4/1.414},\Depth);
	\coordinate (G) at (\fpeval{-#4/1.414},\fpeval{-#4/1.414},0);
	\node[rotate=-45] at (\fpeval{-0.5*#4/1.414},\fpeval{-0.5*#4/1.414},\fpeval{-0.5*#5}) {#1};
	\draw (B) -- (C);
	\draw (F) -- (B) node[midway,xshift=.5em, yshift=.5em] {#3};
	\draw (F) -- (G) node[midway,xshift=-.5em, yshift=.5em] {#2};
	\draw (C) -- (G);
}

\newcommand{\addPlotTheta}[2]{%
	\addplot+ table [
			color=red,
			x=n_blocks,
			y=#1,
			col sep=comma,
			restrict expr to domain={\thisrow{theta}}{#2:#2},
			unbounded coords=discard, % <-- important
		]{data/gridsearch_erp_processed.csv};
}
